<!DOCTYPE html>
<html lang="en">

<head>
    <title>Lightning Pain Diary</title>
    <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
    <meta charset="utf-8">
    <meta id="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script src="https://www.w3schools.com/lib/w3.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>
    <div w3-include-html="https://raw.githubusercontent.com/spip01/lightningpaindiary/master/navbar.html"></div>
    <br>

    <div class="w3-card">
        <header class="w3-container w3-light-gray">
            <h2 style="color: rgb(0, 78, 0);">Pain level</h2>
        </header>
        <br>

        <div id="painlevelpanel" class="w3-container w3-bar w3-round">
            <button type="button" class="w3-btn w3-small w3-bar-item w3-ripple w3-hover-light-gray setPainLevel
               " style="background-color: rgb(000, 255, 0); width:10%" onclick="painButtons(event)">1</button>
            <button type="button" class="w3-btn w3-small w3-bar-item w3-ripple w3-hover-light-gray setPainLevel
               " style="background-color: rgb(120, 255, 0); width:10%" onclick="painButtons(event)">2</button>
            <button type="button" class="w3-btn w3-small w3-bar-item w3-ripple w3-hover-light-gray setPainLevel
               " style="background-color: rgb(180, 255, 0); width:10%" onclick="painButtons(event)">3</button>
            <button type="button" class="w3-btn w3-small w3-bar-item w3-ripple w3-hover-light-gray setPainLevel
               " style="background-color: rgb(220, 255, 0); width:10%" onclick="painButtons(event)">4</button>
            <button type="button" class="w3-btn w3-small w3-bar-item w3-ripple w3-hover-light-gray setPainLevel
               " style="background-color: rgb(255, 255, 0); width:10%" onclick="painButtons(event)">5</button>
            <button type="button" class="w3-btn w3-small w3-bar-item w3-ripple w3-hover-light-gray setPainLevel
               " style="background-color: rgb(255, 225, 0); width:10%" onclick="painButtons(event)">6</button>
            <button type="button" class="w3-btn w3-small w3-bar-item w3-ripple w3-hover-light-gray setPainLevel
               " style="background-color: rgb(255, 175, 0); width:10%" onclick="painButtons(event)">7</button>
            <button type="button" class="w3-btn w3-small w3-bar-item w3-ripple w3-hover-light-gray setPainLevel
               " style="background-color: rgb(255, 125, 0); width:10%" onclick="painButtons(event)">8</button>
            <button type="button" class="w3-btn w3-small w3-bar-item w3-ripple w3-hover-light-gray setPainLevel
               " style="background-color: rgb(255, 070, 0); width:10%" onclick="painButtons(event)">9</button>
            <button type="button" class="w3-btn w3-small w3-bar-item w3-ripple w3-hover-light-gray setPainLevel
               " style="background-color: rgb(255, 000, 0); width:10%" onclick="painButtons(event)">10</button>
        </div>
        <br>

        <div id="detail" class="w3-container w3-small" style="display: none">
            <header class="w3-container w3-light-gray" style="color: rgb(0, 78, 0);">
                Date & Time
            </header>

            <input id="entryDate" class="w3-border w3-round" type="datetime-local">
            <br>
            <br>

            <div id="medications"></div>
            <div id="triggers"></div>
            <div id="painlocation"></div>
            <div id="paintype"></div>
            <div id="warnings"></div>
            <br>

            <header class="w3-container w3-light-gray" style="color: rgb(0, 78, 0);">
                Relief
            </header>

            <div id="relieflevelpanel" class="w3-container w3-bar w3-round">
                <button type="button" class="w3-btn w3-tiny w3-bar-item w3-ripple w3-hover-light-gray setReliefLevel
               " style="background-color: rgb(0, 255, 0);" onclick="reliefButtons(event)">5</button>
                <button type="button" class="w3-btn w3-tiny w3-bar-item w3-ripple w3-hover-light-gray setReliefLevel
               " style="background-color: rgb(180, 255, 0);" onclick="reliefButtons(event)">4</button>
                <button type="button" class="w3-btn w3-tiny w3-bar-item w3-ripple w3-hover-light-gray setReliefLevel
               " style="background-color: rgb(255, 255, 0);" onclick="reliefButtons(event)">3</button>
                <button type="button" class="w3-btn w3-tiny w3-bar-item w3-ripple w3-hover-light-gray setReliefLevel
               " style="background-color: rgb(255, 175, 0);" onclick="reliefButtons(event)">2</button>
                <button type="button" class="w3-btn w3-tiny w3-bar-item w3-ripple w3-hover-light-gray setReliefLevel
               " style="background-color: rgb(255, 70, 0);" onclick="reliefButtons(event)">1</button>
            </div>
            <br>

            <button type="button" class="w3-btn w3-tiny w3-border w3-round w3-ripple" onclick="entryButtons(event)">Update</button>
            <button type="button" class="w3-btn w3-tiny w3-border w3-round w3-ripple" onclick="entryButtons(event)">New</button>
            <button type="button" class="w3-btn w3-tiny w3-border w3-round w3-ripple" onclick="entryButtons(event)">Cancel</button>
        </div>
        <br>
    </div>
    <br>

    <p id="diag"></p>
    <p id="diag2"></p>

    <script>
        w3.includeHTML();

        // entry values
        var createdDate = new Date();
        var changedDate = new Date();
        var entryDate = new Date();
        var painlevel = "";
        var relieflevel = "";

        var medicines = "";
        var triggers = "";
        var painlocation = "";
        var paintype = "";
        var warnings = "";

        // previous entry values
        var createdDateOld = createdDate;
        var changedDateOld = changedDate;
        var entryDateOld = entryDate;
        var painlevelOld = painlevel;
        var relieflevelOld = relieflevel;

        var medicinesOld = medicines;
        var triggersOld = triggers;
        var painlocationOld = painlocation;
        var paintypeOld = paintype;
        var warningsOld = warnings;

        // get these from db
        var medlist = "kepra,rbn6d,g,vevr,brnfev,breb,vewecw,brcwc";
        var triggerlist = "weather,smells";
        var locationlist = "forehead,temple,eyes,left,right,all";
        var typelist = "throbbing,burning,pressure,sharp";
        var warninglist = "aura";

        setupCheckboxList("Medicines", "medications", medlist);
        setupCheckboxList("Triggers", "triggers", triggerlist);
        setupCheckboxList("Pain Location", "painlocation", locationlist);
        setupCheckboxList("Pain Type", "paintype", typelist);
        setupCheckboxList("Warnings", "warnings", warninglist);

        function setupCheckboxList(title, id, list) {
            var panel = document.getElementById(id);
            var row = '<div class="w3-row">';
            var col =
                '<div class="w3-col" style="width:20%">' +
                '<input id = "iname" class = "w3-check" style = "width:12px" type = "checkbox">' +
                '<label class = "w3 - small">' +
                'lname' +
                '</label>' +
                '</div>';
            var html = '<header class="w3-container w3-light-gray" style="color: rgb(0, 78, 0);">' +
                title +
                '</header>' +
                row;

            var items = list.split(",").sort();
            for (i = 0; i < items.length; ++i) {
                html += col.replace("iname", items[i]).replace("lname", items[i]);

                if ((i + 1) % 5 == 0)
                    html += '</div>' + row;
            }

            html += '</div></div>';
            panel.innerHTML += html;
        }

        function procCheckboxList(list) {
            var rstr = "";
            var items = list.split(",").sort();

            for (i = 0; i < items.length; ++i) {
                chk = document.getElementById(items[i]);
                if (chk.checked)
                    rstr += items[i] + ",";
            }

            rstr = rstr.slice(0, rstr.length - 1);

            return rstr;
        }

        function resetCheckboxList(list, set) {
            var items = list.split(",").sort();
            var setitems = set.split(",").sort();

            var i, j;

            for (i = 0; i < items.length; ++i) {
                chk = document.getElementById(items[i]);
                chk.removeAttribute("checked");

                for (j = 0; j < setitems.length; ++j) {
                    if (items[i] == setitems[j]) {
                        chk.setAttribute("checked", "");
                        break;
                    }
                }
            }
        }

        function painButtons(event) {
            painlevel = event.currentTarget.innerHTML;

            var panel = document.getElementById("detail");
            if (panel.style.display === "none") {
                panel.style.display = "block";

                var edate = document.getElementById("entryDate");
                edate.value = createdDate.toDateTimeLocalString();

                newEntry()
                diag();
            }

            var i;
            var pl = document.getElementsByClassName("setPainLevel");

            for (i = 0; i < pl.length; i++) {
                pl[i].className = pl[i].className.replace(" w3-aqua", "");
            }

            event.currentTarget.className += " w3-aqua";
        }

        function reliefButtons(event) {
            relieflevel = event.currentTarget.innerHTML;

            var i;
            var rl = document.getElementsByClassName("setReliefLevel");

            for (i = 0; i < rl.length; i++) {
                rl[i].className = rl[i].className.replace(" w3-aqua", "");
            }

            event.currentTarget.className += " w3-aqua";
        }

        function entryButtons(event) {
            if (event.currentTarget.innerHTML == "Update")
                updateEntry();
            else if (event.currentTarget.innerHTML == "New")
                newEntry();
            else if (event.currentTarget.innerHTML == "Cancel")
                cancelEntry()

            diag();
        }

        function newEntry() {
            createdDate = new Date();
            changedDate = new Date();

            //** keep current entry date so it doesn't have to be completely reentered every time **
            //var edate = document.getElementById("entryDate");
            //edate.value = createdDate.toDateTimeLocalString();
        }

        function updateEntry() {
            changedDate = new Date();

            var edate = document.getElementById("entryDate");
            entryDate = new Date(edate.value);

            medicines = procCheckboxList(medlist);
            triggers = procCheckboxList(triggerlist);
            painlocation = procCheckboxList(locationlist);
            paintype = procCheckboxList(typelist);
            warnings = procCheckboxList(warninglist);

            createdDateOld = createdDate;
            changedDateOld = changedDate;
            entryDateOld = entryDate;
            painlevelOld = painlevel;
            relieflevelOld = relieflevel;

            medicinesOld = medicines;
            triggersOld = triggers;
            painlocationOld = painlocation;
            paintypeOld = paintype;
            warningsOld = warnings;
        }

        function cancelEntry() {
            createdDate = createdDateOld;
            changedDate = changedDateOld;
            entryDate = entryDateOld;
            painlevel = painlevelOld;
            relieflevel = relieflevelOld;

            medicines = medicinesOld;
            triggers = triggersOld;
            painlocation = painlocationOld;
            paintype = paintypeOld;
            warnings = warningsOld;

            var edate = document.getElementById("entryDate");
            edate.value = entryDate.toDateTimeLocalString();

            var i;
            var pl = document.getElementsByClassName("setPainLevel");

            for (i = 0; i < pl.length; i++) {
                if (painlevel == pl[i].innerText)
                    pl[i].className += " w3-aqua";
                else
                    pl[i].className = pl[i].className.replace(" w3-aqua", "");
            }            

            pl = document.getElementsByClassName("setReliefLevel");

            for (i = 0; i < pl.length; i++) {
                if (relieflevel == pl[i].innerText)
                    pl[i].className += " w3-aqua";
                else
                    pl[i].className = pl[i].className.replace(" w3-aqua", "");
            }

            resetCheckboxList(medlist, medicines);
            resetCheckboxList(triggerlist, triggers);
            resetCheckboxList(locationlist, painlocation);
            resetCheckboxList(typelist, paintype);
            resetCheckboxList(warninglist, warnings);
        }

        function diag() {
            var diag = document.getElementById("diag");
            diag.innerHTML =
                "<br>created: " + createdDate.toISOString() +
                "<br>updated: " + changedDate.toISOString() +
                "<br>entry: " + entryDate.toISOString() +
                "<br>pain: " + painlevel +
                "<br>meds: " + medicines +
                "<br>triggers: " + triggers +
                "<br>location: " + painlocation +
                "<br>type: " + paintype +
                "<br>warnings: " + warnings +
                "<br>relief: " + relieflevel;
        }

        Date.prototype.toDateTimeLocalString =
            function toDateTimeLocalString() {
                var date = this;
                var ten = function (i) {
                    return i < 10 ? '0' + i : i;
                }
                return date.getFullYear() +
                    "-" + ten(date.getMonth() + 1) +
                    "-" + ten(date.getDate()) +
                    "T" + ten(date.getHours()) +
                    ":" + ten(date.getMinutes());
            }
    </script>

    <div>
        <br>
        <br>log - name
        <br>&nbsp;&nbsp; pain
        <br>&nbsp;&nbsp;&nbsp;&nbsp; date
        <br>&nbsp;&nbsp;&nbsp;&nbsp; time
        <br>&nbsp;&nbsp;&nbsp;&nbsp; level
        <br>&nbsp;&nbsp;&nbsp;&nbsp; medications (ck boxes +add)
        <br>&nbsp;&nbsp;&nbsp;&nbsp; relief
        <br>
        <br>&nbsp;&nbsp;&nbsp;&nbsp; type (burning, throbbing... ck boxes)
        <br>
        <br>&nbsp;&nbsp;&nbsp;&nbsp; headache
        <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; location (ck boxes)
        <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; triggers (ck boxes)
        <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; warnings (ck boxes)
        <br>
        <br>&nbsp;&nbsp; bp
        <br>&nbsp;&nbsp; weight
        <br>&nbsp;&nbsp; notes
        <br>
        <br>&nbsp;&nbsp; --new
        <br>&nbsp;&nbsp; --edit
        <br>&nbsp;&nbsp; --delete
        <br>
        <br>
        <br>calendar
        <br>
        <br>
        <br>reports
        <br>&nbsp;&nbsp; format
        <br>&nbsp;&nbsp;&nbsp;&nbsp; fields (ck boxes)
        <br>&nbsp;&nbsp; qr code - short url
        <br>&nbsp;&nbsp; email
        <br>&nbsp;&nbsp; print
        <br>
        <br>
        <br>medlist
        <br>&nbsp;&nbsp; preventative
        <br>&nbsp;&nbsp; abortive
        <br>&nbsp;&nbsp; drugs.com profile link
        <br>
        <br>
        <br>doctors
        <br>
        <br>
        <br>settings
        <br>&nbsp;&nbsp; remind to complete
        <br>
        <br>
        <br>contact about copyright
    </div>

    <div w3-include-html="https://raw.githubusercontent.com/spip01/lightningpaindiary/master/footer.html"></div>
</body>

</html>