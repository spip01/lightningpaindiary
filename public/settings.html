<!DOCTYPE html>
<html lang="en">

<head>
    <title>Lightning Pain Diary</title>
    <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
    <meta charset="utfoot-8">
    <meta name="viewport" content="">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="https://www.w3schools.com/lib/w3.js"></script>
    <script src="https://unpkg.com/xregexp/xregexp-all.js"></script>
</head>

<style>
    .clr-dark-green {
        color: #008000;
    }

    .bgd-light-gray {
        background-color: #f0f0f0;
    }

    .bgd-dark-gray {
        background-color: #c0c0c0;
    }

    .btn-grey-green {
        color: #008000;
        background-color: #f0f0f0;
        border-color: #008000
    }

    .btn-grey-green:hover {
        color: #008000;
        background-color: #f0f0f0;
        border-color: #008000
    }

    .btn-grey-green.focus,
    .btn-grey-green:focus {
        box-shadow: 0 0 0 .2rem rgba(0, 60, 0, .5)
    }

    .btn-grey-green.disabled,
    .btn-grey-green:disabled {
        color: #008000;
        background-color: #f0f0f0;
        border-color: #008000
    }

    .btn-grey-green:not(:disabled):not(.disabled).active,
    .btn-grey-green:not(:disabled):not(.disabled):active,
    .show>.btn-grey-green.dropdown-toggle {
        color: #008000fff;
        background-color: #f0f0f0;
        border-color: #008000
    }

    .btn-grey-green:not(:disabled):not(.disabled).active:focus,
    .btn-grey-green:not(:disabled):not(.disabled):active:focus,
    .show>.btn-grey-green.dropdown-toggle:focus {
        box-shadow: 0 0 0 .2rem rgba(0, 60, 0, .5)
    }
</style>

<body>
    <div w3-include-html="https://raw.githubusercontent.com/spip01/lightningpaindiary/bootstrap/public/navbar.html"></div>

    <div id="javascript" class="">
        <div class="">
            <a href="index.html" class="" style="color: rgb(0, 78, 0);">
                <i class="" style="font-size:18px"></i>
                Lightning Pain Diary
            </a>
            <a href="about.html" class=""> About </a>
        </div>
        </br>

        <div id="javascript" class="" style="color: rgb(0, 78, 0);">
            Unfortunately, this page cannot function without javasript. Please add this site to your "allowed" sites located at chrome://settings/content/javascript
        </div>
        </br>
    </div>


    <div id="jssite" class="" style="display: none">
        <div id="tabs"></div>

        <div id="panels" class="card card-body d-flex bgd-light-gray">

            <div id="pnl-account" class="card card-body d-flex" style="display: block">
                <h4 class="card-title border-bottom">Account</h4>

                <div class="container-fluid">
                    <div class="row">
                        load medicines from drugs.com
                    </div>

                    <div class="container-fluid">
                        <div class="row">
                            <input id="drugs-com" type="text" class="rounded col-lg-3 col-md-3 col-sm-3" placeholder="drugs.com/mn/xxxxx">&nbsp;
                            <button id="loaddrugscom" type="button" class="btn btn-sm btn-grey-green col-lg-2 col-md-2 col-sm-2">Load</button>
                        </div>
                    </div>
                </div>
                <br>

                <label>
                    <input id="reminderbtn" type="checkbox"> Complete these entries or notify at end of day</input>
                </label>

                <!-- generated ck box for each tracked item, hitting submit closes all entries, notification would only happen by pressing "pain level" to create and then leaving -->
                <div id="build-notifications" class="container-fluid">
                    <div class="row">
                        <div class="col-lg-3 col-md-3 col-sm-3">
                            <label>
                                <input id="Pain-Type" type="checkbox"> Pain Type</input>
                            </label>
                        </div>
                        <div class="col-lg-3 col-md-3 col-sm-3">
                            <label>
                                <input id="Pain-Type" type="checkbox"> Relief Level</input>
                            </label>
                        </div>
                    </div>
                </div>
                <br>

                <label>
                    <input id="notificationbtn" type="checkbox"> Complete entry reminder notification via: (this is the only personal data saved)</input>
                </label>

                <div class="container-fluid">
                    <div class="row">
                        <div class=" col-lg-2 col-md-2 col-sm-2">
                            <input id="ifemail" type="checkbox"> email</input>
                        </div>

                        <input id="email" type="text" class="rounded col-lg-3 col-md-3 col-sm-3" placeholder="email address">
                        <div class=" col-lg-2 col-md-2 col-sm-2">
                            <input id="vfyemail" type="checkbox"> verified</input>
                        </div>
                    </div>

                    <label>
                        <input id="ifsms" type="checkbox"> &nbsp;sms (if you are still charged for sms you should change carriers &#x1f609;)
                        </input>
                    </label>

                    <div class="row">
                        <div class="container-fluid">
                            <div class="container-fluid">
                                <input id="phone" type="text" class="rounded col-lg-3 col-md-3 col-sm-3" placeholder="phone number">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="diag"></div>

    <script>
        w3.includeHTML();

        var trackerstypes = ["blood pressure", "date", "list", "number",
            "range", "range buttons", "range slider", "time", "true/false", "weather"
        ];

        var trackerslist = [ // sql, can't reuse names with stored data unless confirmed by user for deletion
            // new user start pain level, start time, remedies, relief
            {
                name: "Pain Level",
                type: "range buttons",
                start: "1",
                end: "10",
                enabled: true
            }, {
                name: "Start Time",
                type: "date",
                enabled: true
            }, {
                name: "End Time",
                type: "time",
                enabled: true
            }, {
                name: "Woke With",
                type: "true/false",
                enabled: true
            }, {
                name: "Pain Location",
                type: "list",
                list: ["forehead", "temple", "eyes", "left", "right"],
                enabled: true
            }, {
                name: "Pain Type",
                type: "list",
                list: ["throbbing", "burning", "pressure", "sharp"],
                //            list: [{"item":"throbbing"}, {"item":"burning"}, {"item":"pressure"}, {"item":"sharp"}],
                enabled: true
            }, {
                name: "Sensitivities",
                type: "list",
                list: ["light", "sound"],
                enabled: true
            }, {
                name: "Remedies",
                type: "list",
                // pull drug list from drugs.com sharing link (link not saved)
                list: ["kepra", "relafin", "haldol", "cogentin", "benadryl", "compazine", "sleep"],
                enabled: true
            }, {
                name: "Triggered By",
                type: "list",
                list: ["weather", "smells", "sleep", "light", "sound"],
                enabled: true
            }, {
                name: "Warnings",
                type: "list",
                list: ["aura", "tunnel vision", "light sensitivity", "sound sensitivity",
                    "smell sensitivity"
                ],
                enabled: true
            }, {
                name: "Pain Relief",
                type: "range buttons",
                start: "5",
                end: "1",
                enabled: true
            }, {
                name: "Mood Level",
                type: "range buttons",
                start: "1",
                end: "10",
                enabled: true
            }, {
                name: "Weather",
                type: "weather",
                list: ["temp", "humidity", "pressure"],
                // http://openweathermap.org/api
                // https://developer.yahoo.com/weather/
                enabled: true
            }, {
                name: "Blood Pressure",
                type: "blood pressure",
                enabled: true
            }, {
                name: "Weight",
                type: "number",
                enabled: true
            }
        ];

        /******* parent of inputs always has idname *******/
        var head =
            `            
                <div id="pnl-idname" class="card card-body d-flex" style="display: none">
                    <div id="ttl-idname">
                        <div id="ttl-title" class="card-title"><h4>ttitle</h4></div>
                        <button id="edittrackerbtn" type="button" class="btn btn-sm btn-border btn-grey-green" ifpanel>Edit</button>
                        <input id="enabledeleteck" type="checkbox">Enable Delete Buttons</input>
                    </div>
                    <div class="border-bottom" ifpanel>
                        controls what data is used as checkboxes and saved on the entry page. drag to rearrange which changes order on entry page.
                        deleting items doesn't delete any saved data just the controls. the data can be recovered by re-adding the item.
                    </div>
                    <div class="border-bottom" iftracker>
                        controls sections displayed and saved on the entry page. drag to rearrange which changes order on entry page.
                        deleting items doesn't delete any saved data just the controls. the data can be recovered by re-adding the item.
                    </div>

                    <div class="container-fluid">
            `;

        var entry =
            `
                        <div class="row border-bottom">
                            <div id="ent-idname">
                                <div class="col-lg-4 col-md-4 col-sm-4" draggable="true">ttitle</div>
                                <div iftracker>
                                    <div class="col-lg-3 col-md-3 col-sm-3">ttype</div>
                                    <div class="col-lg-3 col-md-3 col-sm-3">
                                        <div ifrange>startrange-endrange</div>
                                    </div>
                                </div>

                                <!-- edit disables all other buttons -->
                                <button id="editbtn" type="button col-lg-2 col-md-2 col-sm-2" class="btn btn-sm btn-border btn-grey-green">Edit</button>
                                <button id="delbtn" type="button col-lg-2 col-md-2 col-sm-2" class="btn btn-sm btn-border btn-grey-green">Delete</button>
                            </div>
                        </div>
            `;

        var tail =
            `
                       <div class="row">
                            <div id="botm-idname" class="">
                                <br>
                                <input id="addinp" class="rounded col-lg-4 col-md-4 col-sm-43" type="text" placeholder="ttitle">
                                <div class="" iftracker>
                                    Type
            `;
        var tail_tracker_menu =
            `
                                        <button id="menuitem" class="">ttype</button>
            `
        var tail_end =
            `
                                </div>
                                <div id="rnge-tracker" ifrange>
                                    <input id="startrangeinp" class="rounded" type="text" placeholder="1">
                                    <input id="endrangeinp" class="rounded" type="text" placeholder="10">
                                </div>
                                <button id="addtrackerbtn" type="button" class="btn btn-sm btn-border btn-grey-green">Add</button>
                                <button id="recovertrackerbtn" type="button" class="btn btn-sm btn-border btn-grey-green">Recover</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

        var tab_head =
            `
                    <div id="pnl-account" class="">Account</div>
                    <div id="pnl-tracker" class="">Tracker</div>
                `;
        var tab_entries =
            `
                    <div id="pnl-idname" class="">ttitle</div>
                `;


        function generateTrackerPanel() {
            var id = "tracker";
            var name = "Tracker";

            var ttitle = /idname/g [Symbol.replace](head, id);
            ttitle = /ttitle/g [Symbol.replace](ttitle, name);
            ttitle = /ifpanel/g [Symbol.replace](ttitle, "style='display: none'");
            ttitle = /iftracker/g [Symbol.replace](ttitle, "");

            var tentry = "";

            for (var i = 0; i < trackerslist.length; ++i) {
                var item = trackerslist[i];
                var iid = / /g [Symbol.replace](item.name, "-");

                var t = entry;
                t = /idname/g [Symbol.replace](t, iid);
                t = /ttitle/g [Symbol.replace](t, item.name);
                t = /ttype/g [Symbol.replace](t, item.type);
                t = /iftracker/g [Symbol.replace](t, "");

                if (item.type.indexOf("range") != -1) {
                    t = /ifrange/g [Symbol.replace](t, "");
                    t = /startrange/g [Symbol.replace](t, item.start);
                    t = /endrange/g [Symbol.replace](t, item.end);
                } else
                    t = /ifrange/g [Symbol.replace](t, 'style="display: none"');

                tentry += t;
            }

            var tmenu = "";

            // generate type menu
            for (var i = 0; i < trackerstypes.length; ++i) {
                tmenu += /ttype/g [Symbol.replace](tail_tracker_menu, trackerstypes[i]);
            }

            var ttail = /idname/g [Symbol.replace](tail, id);
            ttail = /ttitle/g [Symbol.replace](ttail, name);
            ttail = /iftracker/g [Symbol.replace](ttail, "");

            var tend = /ifrange/g [Symbol.replace](tail_end, 'style="display: none"');

            $("#panels").append(ttitle + tentry + ttail + tmenu + tend);
        }

        function generatePanels() {
            // w3.displayObject(selector)
            // w3.getHttpObject("customers.js", myFunction);

            for (var i = 0; i < trackerslist.length; ++i) {
                var item = trackerslist[i];

                if (item.type === "list") {
                    var id = / /g [Symbol.replace](item.name, "-");
                    var name = item.name;

                    var ttitle = /idname/g [Symbol.replace](head, id);
                    ttitle = /ttitle/g [Symbol.replace](ttitle, name);
                    ttitle = /ifpanel/g [Symbol.replace](ttitle, "");
                    ttitle = /iftracker/g [Symbol.replace](ttitle, "style='display: none'");

                    tentry = "";
                    for (var j = 0; j < item.list.length; ++j) {
                        var t = entry;
                        var iid = / /g [Symbol.replace](item.list[j], "-");
                        t = /idname/g [Symbol.replace](t, iid);
                        t = /ttitle/g [Symbol.replace](t, item.list[j]);
                        t = /iftracker/g [Symbol.replace](t, "style='display: none'");
                        t = /ifrange/g [Symbol.replace](t, "style='display: none'");

                        tentry += t;
                    }

                    var ttail = /idname/g [Symbol.replace](tail, id);
                    ttail = /ttitle/g [Symbol.replace](ttail, name);
                    ttail = /iftracker/g [Symbol.replace](ttail, 'style="display: none"');

                    var tend = /ifrange/g [Symbol.replace](tail_end, 'style="display: none"');

                    $("#panels").append(ttitle + tentry + ttail + tend);
                }
            }
        }

        function generateTabs() {
            var tabs = "";

            for (var i = 0; i < trackerslist.length; ++i) {
                var item = trackerslist[i];

                if (item.type === "list" && item.enabled) {
                    var id = / /g [Symbol.replace](item.name, "-");
                    var tab = /idname/g [Symbol.replace](tab_entries, id);
                    tabs += /ttitle/g [Symbol.replace](tab, item.name);
                }
            }

            $("#tabs").empty();
            $("#tabs").append(tab_head + tabs);

            $("#tabs div").click(function () {
                openTab(this);
            });
        }

        function openTab(evt) {
            $("#tabs div").removeClass("bgd-dark-gray");
            $(evt).addClass("bgd-dark-gray");

            $("#panels").children().hide();
            $("#panels").children("#" + $(evt).prop("id")).show();
        }

        function dragover(evt) {
            evt.preventDefault();
        }

        function dragstart(evt) {
            evt.originalEvent.dataTransfer.setData("text/html", this.parentElement.id);
        }

        function drop(evt) {
            evt.preventDefault();
            var src = evt.originalEvent.dataTransfer.getData("text/html");
            var dst = evt.target.parentElement.id;
            var pt = evt.target.parentElement.parentElement.id;

            var list = [];
            var found = 0;
            $("#panels #" + pt).children().each(function () {
                var id = $(this).prop("id");

                switch (id) {
                    case dst: // move up
                        if (found == 0) {
                            list.push($("#panels #" + src).detach());
                            list.push($("#panels #" + dst).detach());
                            found = 2;
                        } else if (found == 1) {
                            list.push($("#panels #" + dst).detach());
                            list.push($("#panels #" + src).detach());
                            found = 2;
                        }
                        break;
                    case src: // move down
                        if (found == 0)
                            found = 1;
                        break;
                    default: //$("#diag").append("add id " + id + "");
                        list.push($(this).detach());
                }
            });

            for (var i = 0; i < list.length; ++i) {
                $("#panels #" + pt).append(list[i]);
            }
        }

        function useTracker(evt) {
            var pnl = $(evt).parent().prop("id").replace(/.*?-(.*)/g, "$1");

            for (var i = 0; i < trackerslist.length; ++i) {
                var item = trackerslist[i];
                var id = / /g [Symbol.replace](item.name, "-");

                if (id === pnl) {
                    item.enabled = $(evt).prop("checked");
                    generateTabs();
                }
            }
        }

        function enableDeleteBtns(evt) {
            var pnl = $(evt).parent().parent().prop("id");
            if ($(evt).prop("checked"))
                $("#" + pnl + " #delbtn").removeClass("w3-disabled");
            else
                $("#" + pnl + " #delbtn").addClass("w3-disabled");
        }


        $(document).ready(function () {
            generateTabs();
            generatePanels();
            generateTrackerPanel();

            //$("#tabs div").click(function () {
            //    openTab(this);
            //});

            $("#panels #enabledeleteck").click(function () {
                enableDeleteBtns(this);
            });

            $("#panels #usetrackerckb").click(function () {
                useTracker(this);
            });

            $("#javascript").empty();
            $("#jssite").show();

            $("#panels [draggable|='true']").on({
                //"mouseleave": $.proxy(mouseLeave),
                //"mouseenter": $.proxy(mouseEnter),
                "drop": $.proxy(drop),
                "dragover": $.proxy(dragover),
                "dragstart": $.proxy(dragstart)
            });
        });
    </script>

    <div w3-include-html="https://raw.githubusercontent.com/spip01/lightningpaindiary/bootstrap/public/footer.html"></div>
</body>

</html>