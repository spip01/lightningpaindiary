<!DOCTYPE html>
<html lang="en">

<head>
    <title>Lightning Pain Diary</title>
    <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
    <meta charset="utf-8">
    <meta id="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script src="https://www.w3schools.com/lib/w3.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>
    <div w3-include-html="https://raw.githubusercontent.com/spip01/lightningpaindiary/master/navbar.html"></div>

    <br>
    <div class="w3-light-gray w3-container w3-card">

        <div id="tabs">
            <div id="account" class="w3-btn w3-mobile w3-hover-dark-gray w3-dark-gray">Account</div>
            <div id="trackers" class="w3-btn w3-mobile w3-hover-dark-gray w3-border-right w3-border-gray">Trackers</div>
        </div>
        <br>

        <div id="panels" class="w3-light-gray w3-card">

            <div id="account" class="w3-container" style="display: block">
                <div id="accounttabs" class="w3-container w3-small">
                    <div id="account" class="w3-btn w3-mobile w3-hover-dark-gray w3-dark-gray">Info</div>
                    <div id="doctors" class="w3-btn w3-mobile w3-hover-dark-gray">Doctors</div>
                    <br>
                </div>

                <div id="accountpanels" class="W3-light-gray w3-card w3-small">

                    <div id="accountinfo" class="w3-container" style="display: block">
                        <p>account info</p>
                    </div>
                </div>
            </div>

            <div id="doctorlist" class="w3-container w3-small" style="display: none">
                <p>This list gets included with printed reports</p>
            </div>
            <br>

        </div>
        <br>
    </div>
    <br>

    <div id="diag">diag
        <br>
    </div>

    <script>
        w3.includeHTML();

        var types = ["range", "date", "list", "weather"];
        var trackinglist = []; // sql
        trackinglist.push({
            name: "Pain Level",
            id: "painlevel",
            type: "range",
            start: "1",
            end: "10"
        });
        trackinglist.push({
            name: "Entry Date",
            id: "entrydate",
            type: "date"
        });
        trackinglist.push({
            name: "Pain Location",
            id: "painlocation",
            type: "list",
            list: ["forehead", "temple", "eyes", "left", "right"]
        });
        trackinglist.push({
            name: "Pain Type",
            id: "paintype",
            type: "list",
            list: ["throbbing", "burning", "pressure", "sharp"]
        });
        trackinglist.push({
            name: "Medications",
            id: "medications",
            type: "list",
            list: ["kepra", "relafin", "haldol", "cogentin", "benadryl", "compazine"]
        });
        trackinglist.push({
            name: "Triggers",
            id: "triggers",
            type: "list",
            list: ["weather", "smells", "sleep"]
        });
        trackinglist.push({
            name: "Warnings",
            id: "warnings",
            type: "list",
            list: ["aura"]
        });
        trackinglist.push({
            name: "Relief Level",
            id: "relieflevel",
            type: "range",
            start: "5",
            end: "1"
        });
        trackinglist.push({
            name: "Mood Level",
            id: "moodlevel",
            type: "range",
            start: "1",
            end: "10"
        });
        trackinglist.push({
            name: "Weather",
            id: "weather",
            type: "weather",
            list: ["temp", "humidity", "pressure"]
            // http://openweathermap.org/api
            // https://developer.yahoo.com/weather/
        });
        trackinglist.push({
            name: "Blood Pressure",
            id: "bloodpressure",
            type: "bloodpressure"
        });

        generateTabs();

        function generateTabs() {
            var tabhtml = '<div id="idname" class="w3-btn w3-mobile w3-hover-dark-gray">ttitle</div>';

            var paneltitle =
                '<div id="idname" class="w3-container w3-border-gray w3-light-gray w3-small" style="display: none">' +
                '    <div id="title" class"w3-cell-row">' +
                '       <div class="w3-cell w3-quarter w3-large">ttitle</div>' +
                '       <div class="w3-cell">' +
                '           <button type="button" class="w3-btn w3-tiny w3-border w3-round w3-ripple">Edit</button>' +
                '           <button type="button" class="w3-btn w3-tiny w3-border w3-round w3-ripple">Delete</button>' +
                '       </div>' +
                '    </div>';
            var panelinfo = 
                '    <div id="info" class="w3-tiny w3-container w3-border-bottom w3-border-gray">(used as checkbox list on entry page, drag to rearrange)</div>';
            var trackinginfo = 
                '    <div id="info" class="w3-tiny w3-container w3-border-bottom w3-border-gray">(controls what parameters are tracked on entry page, drag to rearrange)</div>';
            var panelentries =
                '    <div id="idname" class"w3-cell-row">' +
                '        <div class="w3-container w3-cell w3-quarter" draggable="true">' +
                '            ttitle' +
                '        </div>' +
                '        <div class="w3-cell">' +
                '            <button type="button" class="w3-btn w3-tiny w3-border w3-round w3-ripple">Edit</button>' +
                '            <button type="button" class="w3-btn w3-tiny w3-border w3-round w3-ripple">Delete</button>' +
                '        </div>' +
                '    </div>';
            var trackingentries =
                '    <div id="idname" class"w3-cell-row">' +
                '        <div class="w3-container w3-cell w3-quarter" draggable="true">' +
                '            ttitle' +
                '        </div>' +
                '        <div class="w3-container w3-cell w3-quarter" draggable="true">' +
                '            ttype' +
                '        </div>' +
                '        <div class="w3-cell">' +
                '            <button type="button" class="w3-btn w3-tiny w3-border w3-round w3-ripple">Edit</button>' +
                '            <button type="button" class="w3-btn w3-tiny w3-border w3-round w3-ripple">Delete</button>' +
                '        </div>' +
                '    </div>';
            var addhtml =
                '    <div id="add" class"w3-cell-row">' +
                '        <input id="idname" class="w3-cell w3-quarter w3-input w3-border w3-round" type="text" placeholder="ttitle">' +
                '        <div class="w3-cell">' +
                '            <button id="idname" type="button" class="w3-btn w3-tiny w3-border w3-round w3-ripple">Add</button>' +
                '        </div>' +
                '    </div>' +
                '</div>';

            var th = paneltitle;
            th = th.replace("idname", "trackers").replace("ttitle", "Trackers") + trackinginfo;

            for (var i = 0; i < trackinglist.length; ++i) {
                var entry = trackinglist[i];

                var tl = trackingentries;
                th += tl.replace("idname", "t-"+entry.id).replace("ttitle", entry.name).replace("ttype", entry.type);

                if (entry.type === "list") {
                    var t = tabhtml;
                    $("#tabs").append(t.replace("idname", entry.id).replace("ttitle", entry.name));

                    var h = paneltitle;
                    h = h.replace("idname", entry.id).replace("ttitle", entry.name) + panelinfo;

                    list = entry.list;
                    for (var j = 0; j < list.length; ++j) {
                        var l = panelentries;
                        h += l.replace("idname", list[j]).replace("ttitle", list[j]);
                    }

                    var a = addhtml;
                    h += a.replace("idname", entry.id).replace("ttitle", entry.name);

                    $("#panels").append(h);
                }
            }

            var ta = addhtml;
            th += ta.replace("idname", "trackers").replace("ttitle", "Trackers");

            $("#panels").append(th);

        }

        function openTab(evt) {
            $("#tabs div").removeClass("w3-dark-gray");
            $(evt).addClass("w3-dark-gray");

            $("#panels").children().hide();
            $("#panels").children("#" + $(evt).prop("id")).show();
        }

        function dragover(evt) {
            evt.preventDefault();
        }

        function dragstart(evt) {
            evt.originalEvent.dataTransfer.setData("text/html", this.parentElement.id);
        }

        function drop(evt) {
            evt.preventDefault();
            var src = evt.originalEvent.dataTransfer.getData("text/html");
            var dst = evt.target.parentElement.id;
            var pt = evt.target.parentElement.parentElement.id;

            var list = [];
            var found = false;
            $("#panels #" + pt).children().each(function () {
                var id = $(this).val("id")[0].id;

                switch (id) {
                    case dst:
                        if (!found) {
                            list.push($("#panels #" + src).detach());
                            list.push($("#panels #" + dst).detach());
                            found = true;
                        }
                        break;
                    case src:
                        if (!found) {
                            list.push($("#panels #" + dst).detach());
                            list.push($("#panels #" + src).detach());
                            found = true;
                        }
                        break;
                    default: //$("#diag").append("add id " + id + "<br>");
                        list.push($(this).detach());
                }
            });

            for (var i = 0; i < list.length; ++i) {
                $("#panels #" + pt).append(list[i]);
            }

            //$("#panels #" + src).siblings().each(function () {
            //    $("#diag").append($(this).prop("id") + "<br>");
            //});
        }

        function mouseEnter(evt) {
            //$("#diag").append("enter " + this.innerText + "<br>");
        }

        function mouseLeave(evt) {
            //$("#diag").append("leave " + this.innerText + "<br>");
        }

        $(document).ready(function () {
            $("#tabs div").click(function () {
                openTab(this);
            });

            $("#panels [draggable|='true']").on({
                //"mouseleave": $.proxy(mouseLeave),
                //"mouseenter": $.proxy(mouseEnter),
                "drop": $.proxy(drop),
                "dragover": $.proxy(dragover),
                "dragstart": $.proxy(dragstart)
            });
        });
    </script>

    <br>
    <div w3-include-html="https://raw.githubusercontent.com/spip01/lightningpaindiary/master/footer.html"></div>
</body>

</html>