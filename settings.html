<!DOCTYPE html>
<html lang="en">

<head>
    <title>Lightning Pain Diary</title>
    <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
    <meta charset="utfoot-8">
    <meta id="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script src="https://www.w3schools.com/lib/w3.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<style>
    .w3-sixth {
        width: 16.6666%
    }

    .w3-twelfth {
        width: 8.3333%
    }
</style>

<body>
    <div w3-include-html="https://raw.githubusercontent.com/spip01/lightningpaindiary/master/navbar.html"></div>

    <br>
    <div class="w3-light-gray w3-container w3-card">

        <div id="tabs"></div>

        <div id="panels" class="w3-light-gray w3-container w3-card">
            <div id="pnl-account" class="w3-container w3-border-gray w3-white w3-small" style="display: block">
                <br>
                <div id="doctors">Input Doctors</div>
                <input id="dbname" type="text" class="w3-pad">DB Name</input>
                <br>
                <input id="drugs-com" type="text" class="w3-pad">drugs.com link</input>
                <br>
                <input id="reminder" type="checkbox" class="w3-check" style="width:12px">Complete entry reminder notification</input>
                <br>
                <input id="verifydelete" type="checkbox" class="w3-check" style="width:12px">Verify Deletes</input>
                <br>
                <br>
            </div>
        </div>
        <br>
    </div>

    <div id="diag"></div>

    <script>
        w3.includeHTML();

        var trackingtypes = ["blood pressure", "colored range", "date", "list", "number",
            "range", "time", "true false", "weather"
        ];
        var trackinglist = []; // sql
        trackinglist.push({
            name: "Pain Level",     // can only change name until first save
            type: "colored range",
            start: "1",
            end: "10",
            enabled: true
        });
        trackinglist.push({
            name: "Start Time",
            type: "date",
            enabled: true
        });
        trackinglist.push({
            name: "End Time",
            type: "time",
            enabled: true
        });
        trackinglist.push({
            name: "Woke With",
            type: "true false",
            enabled: true
        });
        trackinglist.push({
            name: "Pain Location",
            type: "list",
            list: ["forehead", "temple", "eyes", "left", "right"],
            enabled: true
        });
        trackinglist.push({
            name: "Pain Type",
            type: "list",
            list: ["throbbing", "burning", "pressure", "sharp"],
            enabled: true
        });
        trackinglist.push({
            name: "Sensitivities",
            type: "list",
            list: ["light", "sound"],
            enabled: true
        });
        trackinglist.push({
            name: "Remedies",
            type: "list",
            list: ["kepra", "relafin", "haldol", "cogentin", "benadryl", "compazine", "sleep"],
            enabled: true
        });
        trackinglist.push({
            name: "Triggered By",
            type: "list",
            list: ["weather", "smells", "sleep", "light", "sound"],
            enabled: true
        });
        trackinglist.push({
            name: "Warnings",
            type: "list",
            list: ["aura", "tunnel vision", "light sensitivity", "sound sensitivity", "smell sensitivity"],
            enabled: true
        });
        trackinglist.push({
            name: "Relief Level",
            type: "colored range",
            start: "5",
            end: "1",
            enabled: true
        });
        trackinglist.push({
            name: "Mood Level",
            type: "colored range",
            start: "1",
            end: "10",
            enabled: true
        });
        trackinglist.push({
            name: "Weather",
            type: "weather",
            list: ["temp", "humidity", "pressure"],
            // http://openweathermap.org/api
            // https://developer.yahoo.com/weather/
            enabled: true
        });
        trackinglist.push({
            name: "Blood Pressure",
            type: "blood pressure",
            enabled: true
        });
        trackinglist.push({
            name: "Weight",
            type: "number",
            enabled: true
        });

        generateTabs();
        generatePanels();
        generateTrackerPanel();

        /******* parent of inputs always has idname *******/

        function generatePanels() {
            var panel_title =
                '    <div id="pnl-idname" class="w3-container w3-border-gray w3-white w3-small" style="display: none">' +
                '        <div id="ttl-idname" class "w3-container w3-cell-row">' +
                '            <div class="w3-cell w3-third w3-large">ttitle</div>' +
                '            <button id="edittrackerbtn"  type="button"   class="w3-btn w3-cell w3-twelfth w3-padding-small w3-light-gray w3-tiny w3-border w3-round w3-ripple">Edit</button>' +
                '            <input id="enabledeletebtns" type="checkbox" class="w3-check w3-cell w3-twelfth" style="width:12px">Enable Delete Buttons</input>' +
                '        </div>' +
                '        <div id="info" class="w3-tiny w3-container w3-border-bottom w3-border-gray">'+
                '            used as checkbox list on entry page, drag to rearrange'+
                '        </div>';
            var panel_entries =
                '        <div id="ent-idname" class "w3-container w3-cell-row">' +
                '            <div class="w3-container w3-cell w3-third" draggable="true">ttitle</div>' +
                '            <button id="editbtn" type="button" class="w3-btn w3-cell w3-twelfth w3-padding-small w3-light-gray w3-tiny w3-border w3-round w3-ripple">Edit</button>' +
                '            <button id="deletebtn"  type="button" class="w3-btn w3-cell w3-twelfth w3-padding-small w3-light-gray w3-tiny w3-border w3-round w3-ripple w3-disabled">Delete</button>' +
                '        </div>';
            var panel_footer =
                '        <div id="foot-idname" class "w3-container w3-cell-row">' +
                '            <input id="addinp" class="w3-cell w3-third w3-input w3-border w3-round" type="text" placeholder="ttitle">' +
                '            <button id="addbtn" type="button" class="w3-btn w3-cell w3-twelfth w3-padding-small w3-light-gray w3-tiny w3-border w3-round w3-ripple">Add</button>' +
                '        </div>' +
                '        <br>' +
                '    </div>';


            for (var i = 0; i < trackinglist.length; ++i) {
                var tlistentry = trackinglist[i];

                if (tlistentry.type === "list") {
                    // generate id name
                    var t = tlistentry.name.split(" ");
                    var id = "";
                    for (var k = 0; k < t.length; ++k) {
                        id = id.concat(t[k]);
                    }
                    id = id.toLocaleLowerCase();

                    // panel title
                    var panel = panel_title;
                    panel = panel.replace("idname", id).replace("idname", id).replace("ttitle", tlistentry.name);

                    // panel entries
                    for (var j = 0; j < tlistentry.list.length; ++j) {
                        tentryname = tlistentry.list[j];

                        // generate id name
                        t = tentryname.split(" ");
                        id = "";
                        for (var k = 0; k < t.length; ++k) {
                            id = id.concat(t[k]);
                        }
                        id = id.toLocaleLowerCase();

                        var l = panel_entries;
                        panel += l.replace("idname", id).replace("ttitle", tentryname);
                    }

                    // completed panel
                    var a = panel_footer;
                    panel += a.replace("idname", id).replace("ttitle", tlistentry.name);
                    $("#panels").append(panel);
                }
            }
        }

        function generateTrackerPanel() {
            var tracker_title =
                '    <div id="pnl-idname" class="w3-container w3-border-gray w3-white w3-small" style="display: none">' +
                '        <div id="ttl-idname" class "w3-cell-row">' +
                '            <div class="w3-large w3-cell w3-twothird">ttitle</div>' +
                '            <input id="enabledeletebtns" type="checkbox" class="w3-check w3-cell w3-twelfth" style="width:12px">Enable Delete Buttons</input>' +
                '        </div>' +
                '        <div id="info" class="w3-tiny w3-container w3-border-bottom w3-border-gray">'+
                '            controls what parameters are tracked on entry page, drag to rearrange, disable with "Use" checkbox'+
                '        </div>';
            var tracker_entries =
                '        <div id="ent-idname" class="w3-cell-row">' +
                '            <div class="w3-cell w3-col w3-quarter" draggable="true">ttitle</div>' +
                '            <div class="w3-cell w3-col w3-sixth">ttype</div>' +
                '            <div class="w3-container w3-cell w3-col w3-sixth">' +
                '                <div ifrange>startrange-endrange</div>' +
                '            </div>' +
                '            <button id="editbtn"      type="button"   class="w3-btn w3-cell w3-twelfth w3-padding-small w3-light-gray w3-tiny w3-border w3-round w3-ripple">Edit</button>' +
                '            <button id="deletebtn"    type="button"   class="w3-btn w3-cell w3-twelfth w3-padding-small w3-light-gray w3-tiny w3-border w3-round w3-ripple w3-disabled">Delete</button>' +
                '            <input id="usetrackerckb" type="checkbox" class="w3-check w3-cell w3-twelfth" style="width:12px" checked>Use</input>' +
                '            <button id="editlistbtn"  type="button"   class="w3-btn w3-cell w3-sixth w3-padding-small w3-light-gray w3-tiny w3-border w3-round w3-ripple" iflist>Edit List</button>' +
                '        </div>';
            var tracker_footer =
                '        <div id="foot-idname" class="w3-cell-row">' +
                '            <input id="addinp" class="w3-cell w3-col w3-quarter w3-input w3-border w3-round" type="text" placeholder="ttitle">' +
                '            <div id="typemenu" class="w3-cell w3-col w3-third w3-dropdown-hover">'+
                '                Type'+
                '                <div class="w3-dropdown-content w3-bar-block">';
            var tracker_menu =
                '                    <button id="trackermenu" class="w3-bar-item w3-btn">ttype</button>';
            var tracker_footer_rem =
            '                    </div>' +
            '                </div>' +
                '            <div id="rangeinput" style="display: none">' +
                '                <input id="startrangeinp" class="w3-input w3-cell w3-col w3-twelfth w3-border w3-round" type="text" placeholder="1">' +
                '                <input id="endrangeinp"   class="w3-input w3-cell w3-col w3-twelfth w3-border w3-round" type="text" placeholder="10">' +
                '                <br>' +
                '            </div>' +
                '            <button id="addbtn" type="button" class="w3-cell w3-btn w3-padding-small w3-twelfth w3-light-gray w3-tiny w3-border w3-round w3-ripple">Add</button>' +
                '        </div>' +
                '        <br>' +
                '    </div>';

            // letter for section prepended to idname

            var tpanel = tracker_title;
            tpanel = tpanel.replace("idname", "trackers").replace("idname", "trackers").replace("ttitle", "Trackers");

            for (var i = 0; i < trackinglist.length; ++i) {
                var tlistentry = trackinglist[i];

                // generate id name
                var t = tlistentry.name.split(" ");
                var id = "";
                for (var j = 0; j < t.length; ++j) {
                    id = id.concat(t[j]);
                }
                id = id.toLocaleLowerCase();

                // setup buttons for range & list types
                t = tracker_entries;
                if (tlistentry.type === "range" || tlistentry.type === "colored range") {
                    t = t.replace("ifrange", "").replace("startrange", tlistentry.start).replace("endrange", tlistentry
                        .end);
                } else {
                    t = t.replace("ifrange", 'style="display: none"');
                }

                if (tlistentry.type === "list") {
                    t = t.replace("iflist", "");
                } else {
                    t = t.replace("iflist", "style='display: none'");
                }

                tpanel += t.replace("idname", id).replace("idname", id)
                    .replace("ttitle", tlistentry.name).replace("ttype", tlistentry.type);
            }

            var ta = tracker_footer;
            tpanel += ta.replace("idname", id).replace("ttitle", "Trackers");

            // generate type menu
            for (var i = 0; i < trackingtypes.length; ++i) {
                var t = tracker_menu;
                tpanel += t.replace("ttype", trackingtypes[i]);
            }

            $("#panels").append(tpanel + tracker_footer_rem);
        }

        function generateTabs() {
            var tab_first = 
            '       <div id="pnl-account" class="w3-btn w3-mobile w3-hover-dark-gray w3-dark-gray">Account</div>' +
            '       <div id="pnl-trackers" class="w3-btn w3-mobile w3-hover-dark-gray w3-border-right w3-border-gray">Trackers</div>';
           var tab_html =
                '    <div id="pnl-idname" class="w3-btn w3-mobile w3-hover-dark-gray">ttitle</div>';

            $("#tabs").empty();
            $("#tabs").append(tab_first);

            for (var i = 0; i < trackinglist.length; ++i) {
                var tlistentry = trackinglist[i];
                if (tlistentry.type === "list" && tlistentry.enabled) {
                    // generate id name
                    var t = tlistentry.name.split(" ");
                    var id = "";
                    for (var j = 0; j < t.length; ++j) {
                        id = id.concat(t[j]);
                    }
                    id = id.toLocaleLowerCase();

                    var t = tab_html;
                    t = t.replace("idname", id).replace("ttitle", tlistentry.name);
                    $("#tabs").append(t);
                }
            }
        }

        function trackerMenu(evt) {
            //console.log(("select " + $(evt).parent()[0].id + " " + $(evt)[0].id + "<br>"));
        }

        function openTab(evt) {
            $("#tabs div").removeClass("w3-dark-gray");
            $(evt).addClass("w3-dark-gray");

            $("#panels").children().hide();
            $("#panels").children("#" + $(evt).prop("id")).show();
        }

        function dragover(evt) {
            evt.preventDefault();
        }

        function dragstart(evt) {
            evt.originalEvent.dataTransfer.setData("text/html", this.parentElement.id);
        }

        function drop(evt) {
            evt.preventDefault();
            var src = evt.originalEvent.dataTransfer.getData("text/html");
            var dst = evt.target.parentElement.id;
            var pt = evt.target.parentElement.parentElement.id;

            var list = [];
            var found = false;
            $("#panels #" + pt).children().each(function () {
                var id = $(this).val("id").prop("id");

                switch (id) {
                    case dst:
                        if (!found) {
                            list.push($("#panels #" + src).detach());
                            list.push($("#panels #" + dst).detach());
                            found = true;
                        }
                        break;
                    case src:
                        if (!found) {
                            list.push($("#panels #" + dst).detach());
                            list.push($("#panels #" + src).detach());
                            found = true;
                        }
                        break;
                    default: //$("#diag").append("add id " + id + "<br>");
                        list.push($(this).detach());
                }
            });

            for (var i = 0; i < list.length; ++i) {
                $("#panels #" + pt).append(list[i]);
            }
        }

        function addEntry(evt) {
        }

        function deleteEntry(evt) {
        }

        function editEntry(evt) {
        }

        function useTracker(evt) {
            var pnl = $(evt).parent().prop("id").split("-")[1];

            for (var i = 0; i < trackinglist.length; ++i) {
                var item = trackinglist[i];
                var t = item.name.split(" ");
                var id = "";
                for (var j = 0; j < t.length; ++j) {
                    id = id.concat(t[j]);
                }
                id = id.toLocaleLowerCase();

                if (id === pnl) {
                    item.enabled = $(evt).prop("checked");
                    generateTabs();
                }
            }
        }

        function editTracker(evt) {
        }

        function newTracker(evt) {
        }

        function enableDeleteBtns(evt) {
            var pnl = $(evt).parent().parent().prop("id");
            if ($(evt).prop("checked"))
                $("#" + pnl + " #deletebtn").removeClass("w3-disabled");
            else
                $("#" + pnl + " #deletebtn").addClass("w3-disabled");
        }

        $(document).ready(function () {
            $("#tabs div").click(function () {
                openTab(this);
            });

            $("#panels #addbtn").click(function () {
                addEntry(this);
            });

            $("#panels #editbtn").click(function () {
                editEntry(this);
            });

            $("#panels #deletebtn").click(function () {
                deleteEntry(this);
            });

            $("#panels #usetrackerckb").click(function () {
                useTracker(this);
            });

            $("#panels #enabledeletebtns").click(function () {
                enableDeleteBtns(this);
            });

            $("#panels #trackermenu").click(function () {
                trackerMenu(this);
            });

            $("#panels #editlistbtn").click(function () {
                activatePanel(this);
            });

            $("#panels [draggable|='true']").on({
                //"mouseleave": $.proxy(mouseLeave),
                //"mouseenter": $.proxy(mouseEnter),
                "drop": $.proxy(drop),
                "dragover": $.proxy(dragover),
                "dragstart": $.proxy(dragstart)
            });
        });
    </script>

    <br>
    <div w3-include-html="https://raw.githubusercontent.com/spip01/lightningpaindiary/master/footer.html"></div>
</body>

</html>